<html>

<head>
    <script type="text/javascript" src="//code.jquery.com/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="//www.google.com/jsapi"></script>

    <script type="text/javascript">

        function drawChart() {

            $.ajax({
                url: "temps.log",
                context: document.body
            }).done(function () {

//                 var temps = `ts:2021-11-28T22:12:29+01:00 t:14.26 h:63 b:2.851
// ts:2021-11-28T22:13:08+01:00 t:14.26 h:63 b:2.851
// ts:2021-11-28T22:24:00+01:00 t:14.24 h:63 b:2.851
// `;

                var temps = arguments[2].responseText.split("\n").filter(Boolean);
                var data = new google.visualization.DataTable();
                //data.addColumn('string', 'time');
                data.addColumn('date', 'Time Of Readout')
                data.addColumn('number', 'Temp [Â°C]');

                temps.forEach((l,i) => {
                    let readings = l.split(" ");
                    //console.log(readings);
                    let time = readings[0].split("ts:")[1];
                    let temperature = readings[1].split("t:")[1];
                    let humidity = readings[2].split("h:")[1];
                    let battery = readings[3].split("b:")[1];

                    data.addRow();
                    data.setValue(i, 0, new Date(time));
                    data.setValue(i, 1, parseFloat(temperature));

                });



                // for(var i = 0; i < temps.length-1; i++){

                // 	var temp = parseFloat(temps[i].split(": ")[1]);
                // 	var time = temps[i].split(" ")[0] + " " + temps[i].split(" ")[1]

                // 	console.log(temp, time);

                // 	data.addRow();
                // 	data.setValue(i, 0, time);
                // 	data.setValue(i, 1, temp);

                // }
                var chart = new google.visualization.LineChart(document.getElementById('chart'));
                chart.draw(data, { width: 1000, height: 240, title: 'Title here' });
            });




        }

        google.load("visualization", "1", { packages: ["corechart"] });
        google.setOnLoadCallback(drawChart);

        setInterval(drawChart, 120 * 1000);




    </script>
</head>

<body>
    <div id="chart"></div>
</body>

</html>